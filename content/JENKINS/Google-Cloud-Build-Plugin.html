<!DOCTYPE html>
<html>
    <head>
        <title>Jenkins : Google Cloud Build Plugin</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Jenkins</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Plugins.html">Plugins</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Jenkins : Google Cloud Build Plugin
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (bwkimmel)</span>, last modified on Aug 17, 2018
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><table class="confluenceTable"><tbody>
<tr>
<th class="confluenceTh"><p> Plugin Information </p></th>
</tr>
<tr>
<td class="confluenceTd"><p> View Google Cloud Build <a href="https://plugins.jenkins.io/google-cloudbuild" class="external-link" rel="nofollow">on the plugin site</a> for more information. </p></td>
</tr>
</tbody></table>
<a href="https://cloud.google.com/cloud-build" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">Google Cloud Build</span></a><span style="color: rgb(0,0,0);"> enables you to build container images and other artifacts from application source code. You can configure builds to fetch dependencies, run unit tests, static analyses, and integration tests, and create artifacts with build tools like docker, gradle, maven, bazel, and gulp. Builds run on Google-hosted infrastructure with 120 free build minutes a day and up to 10 concurrent builds.</span></p><p><span style="color: rgb(0,0,0);">This Jenkins plugin allows you to call Cloud Build as a build step.</span></p><h1 id="GoogleCloudBuildPlugin-Prerequisites"><span style="color: rgb(0,0,0);">Prerequisites</span></h1><ul><li style="list-style-type: disc;"><p><span>In order to run Google Cloud Build, you must set up a Google Cloud account and </span><a href="https://cloud.google.com/cloud-build/docs/quickstarts/curl" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">enable the API</span></a><span>. </span></p></li><li style="list-style-type: disc;"><p><span>You must have a </span><a href="https://jenkins.io/doc/book/getting-started/" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">Jenkins instance set up and running</span></a><span>.</span></p></li><li style="list-style-type: disc;"><p><span>The Cloud Build plugin uses </span><a href="https://wiki.jenkins.io/display/JENKINS/Google+OAuth+Plugin" rel="nofollow"><span style="color: rgb(17,85,204);">google-oauth-plugin</span></a><span> to allow the user to specify credentials for connecting to the cloud instance. You will need to create a Service Account key in the Google Cloud project, then in Jenkins select Google Service Account from private key and upload the private key. Alternatively, if your Jenkins master is running on <a href="https://cloud.google.com/compute/" class="external-link" rel="nofollow">Google Compute Engine</a>, credentials may be obtained from the <a href="https://cloud.google.com/compute/docs/storing-retrieving-metadata" class="external-link" rel="nofollow">metadata server</a>. See the </span><a href="https://wiki.jenkins.io/display/JENKINS/Google+OAuth+Plugin" rel="nofollow"><span style="color: rgb(17,85,204);">google oauth plugin instructions </span></a><span>for more details and links.</span></p></li><li style="list-style-type: disc;"><p><span>Some of the examples below use the </span><a href="https://wiki.jenkins.io/display/JENKINS/Google+Cloud+Storage+Plugin" rel="nofollow"><span style="color: rgb(17,85,204);">google-storage-plugin</span></a><span> to upload and download files from Google Cloud Storage.  Please refer to the </span><a href="https://wiki.jenkins.io/display/JENKINS/Google+Cloud+Storage+Plugin" rel="nofollow"><span style="color: rgb(17,85,204);">google-storage-plugin instructions</span></a><span> for more details on its usage.</span></p></li></ul><h1 id="GoogleCloudBuildPlugin-Helloworld"><span style="color: rgb(0,0,0);">Hello world</span></h1><p><span style="color: rgb(0,0,0);">The Google Cloud Build Plugin takes a build request in JSON or YAML, in the same format as is accepted by </span><a href="https://cloud.google.com/cloud-build/docs/quickstarts/curl" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">Cloud Build through curl</span></a><span style="color: rgb(0,0,0);"> or </span><a href="https://cloud.google.com/cloud-build/docs/quickstarts/gcloud" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">through gcloud</span></a><span style="color: rgb(0,0,0);">, and sends it to the cloud. See Writing </span><a href="https://cloud.google.com/cloud-build/docs/how-to/writing-build-requests" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">Custom Build Requests</span></a><span style="color: rgb(0,0,0);"> for more information on composing the build request.</span></p><p><span style="color: rgb(0,0,0);">The Build step requires selecting the credentials that were configured above, and the Build Request. The build request may be specified inline (as demonstrated below), or from a file located in the Jenkins workspace.</span></p><p><span style="color: rgb(0,0,0);">After the command is sent, the plugin polls the Cloud Build to check the status. If the step fails, the Jenkins step is failed. If it succeeds, the Jenkins step succeeds.</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="700" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/hello-world.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/hello-world.png"></span><br/></span></p><p><span style="color: rgb(0,0,0);">In this example, the build request runs a simple step: in the Ubuntu docker image, which is available by default, it runs the command &quot;echo hello world&quot;.</span></p><p><span style="color: rgb(0,0,0);">Once the build has started, a link to the build log in Google Cloud Console will be appear in the side panel under the Jenkins build.</span></p><p style="text-align: center;"><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="350" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/build-log-action.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/build-log-action.png"></span><br/></span></p><h1 id="GoogleCloudBuildPlugin-Customsubstitutions"><span style="color: rgb(0,0,0);">Custom substitutions</span></h1><p><span style="color: rgb(0,0,0);">The input for this plugin is compatible with the YAML files you would use with curl or gcloud. To maintain this compatibility, we do not perform any Jenkins substitutions on the build request. For example, if the build request contains the string &quot;$BUILD_ID&quot;, it will be passed as-is to Cloud Build, which will interpret it as a </span><a href="https://cloud.google.com/cloud-build/docs/concepts/build-requests#substitutions" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">built-in substitution</span></a><span style="color: rgb(0,0,0);"> (in this case, $BUILD_ID will be replaced by Cloud Build's build ID).</span></p><p><span style="color: rgb(0,0,0);">To allow customization using Jenkins variables, the plugin allows adding user-defined substitutions, in </span><a href="https://cloud.google.com/cloud-build/docs/concepts/build-requests#substitutions" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">the same format as in the build request</span></a><span style="color: rgb(0,0,0);">. The value of the custom substitutions is interpreted using the standard Jenkins rules. The example below shows how Jenkins variables can be used in a build request:</span></p><p><span style="color: rgb(0,0,0);">The &quot;Key&quot; fields are subject to the same constraints as the </span><a href="https://cloud.google.com/cloud-build/docs/concepts/build-requests#substitutions" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">user-defined substitutions</span></a><span style="color: rgb(0,0,0);"> in Cloud Build. The &quot;Value&quot; fields for _CUSTOM1 and _CUSTOM2 are interpreted through Jenkins at runtime, and the bindings are passed to Cloud Build.</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="700" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/substitutions.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/substitutions.png"></span><br/></span></p><h1 id="GoogleCloudBuildPlugin-AttachingSourceCode"><span style="color: rgb(0,0,0);">Attaching Source Code</span></h1><p><span style="color: rgb(0,0,0);">To attach source code to your Google Cloud Build build request, check the &quot;Attach source&quot; box, select the type of source you wish to attach, and complete the associated fields. You may attach source code from the local workspace, from Google Cloud Storage, or from a Google Cloud Source Repository.</span></p><h2 id="GoogleCloudBuildPlugin-Local"><span style="color: rgb(0,0,0);">Local</span></h2><p><span style="color: rgb(0,0,0);">This option is useful, for example, if you use another Jenkins plugin to download source code into your local workspace. Specify the path to the directory within the Jenkins workspace whose contents you wish to attach. This directory will be archived and uploaded to a temporary bucket in Google Cloud Storage.</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="700" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/local.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/local.png"></span><br/></span></p><p><span style="color: rgb(0,0,0);">Once the build starts, a link to the Google Cloud Storage bucket (in Cloud Console) will appear in the side panel for the Jenkins build.</span></p><p style="text-align: center;"><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="350" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/storage-action.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/storage-action.png"></span><br/></span></p><h2 id="GoogleCloudBuildPlugin-GoogleCloudStorage"><span style="color: rgb(0,0,0);">Google Cloud Storage</span></h2><p><span style="color: rgb(0,0,0);">If you already have an archive of your source stored in Google Cloud Storage (for example, an archive uploaded in a previous step using the </span><a href="https://wiki.jenkins.io/display/JENKINS/Google+Cloud+Storage+Plugin" rel="nofollow"><span style="color: rgb(17,85,204);">google-storage-plugin</span></a><span style="color: rgb(0,0,0);">), provide the bucket name and the path within the bucket to the archive.</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="700" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/storage.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/storage.png"></span><br/></span></p><p><span style="color: rgb(0,0,0);">Once the build starts, a link to the Google Cloud Storage bucket (in Cloud Console) will appear in the side panel for the Jenkins build.</span></p><h2 id="GoogleCloudBuildPlugin-GoogleCloudSourceRepository"><span style="color: rgb(0,0,0);">Google Cloud Source Repository</span></h2><p><span style="color: rgb(0,0,0);">If your code is hosted in a Google Cloud Source Repository, specify the project ID (if different from the project associated with your credentials), repository name (if other than &quot;default&quot;), and the branch, tag, or commit from which you wish to build.</span></p><p><span style="color: rgb(0,0,0);"> </span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="700" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/repo.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/repo.png"></span></p><p><span style="color: rgb(0,0,0);">To attach a source repository from a project other than the project associated with your credentials, the requestor's service account as a </span><a href="https://cloud.google.com/source-repositories/docs/setting-up-repositories" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">member with read access</span></a><span style="color: rgb(0,0,0);"> to the source repository. To obtain the service account email, either look up the Cloud Build service account, or simply try this step without permissions and get the email from the error message.</span></p><p><span style="color: rgb(0,0,0);">Once the build starts, a link to the Google Cloud Source Repository (in Cloud Platform Console) will appear in the side panel for the Jenkins build.</span></p><p style="text-align: center;"><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="350" src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/repo-action.png" data-image-src="https://raw.githubusercontent.com/jenkinsci/google-cloudbuild-plugin/master/docs/images/repo-action.png"></span><br/></span></p><h1 id="GoogleCloudBuildPlugin-PipelineasCode"><span style="color: rgb(0,0,0);">Pipeline as Code</span></h1><p><a href="https://jenkins.io/solutions/pipeline/" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">Jenkins Pipeline</span></a><span style="color: rgb(0,0,0);"> allows for the build/test/deploy pipeline to be specified in the form of </span><a href="http://groovy-lang.org/" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">Groovy</span></a><span style="color: rgb(0,0,0);"> code, which may be stored in a file (</span><span style="color: rgb(0,0,0);">Jenkinsfile</span><span style="color: rgb(0,0,0);">) included alongside the rest of the source code under version control. Cloud Build may also be invoked from a pipeline. For example:</span></p><pre><span><span><br/></span></span></pre><pre>node {</pre><pre>    stage('Build') {</pre><pre>        def message = 'Hello, World!'</pre><pre> </pre><pre>        googleCloudBuild \</pre><pre>            credentialsId: 'my-project',</pre><pre>            source: local('src'),</pre><pre>            request: file('cloudbuild.yaml'),</pre><pre>            substitutions: [</pre><pre>                _CUSTOM1: message,</pre><pre>                _CUSTOM2: &quot;Lorem ipsum, dolor sit amet.&quot;</pre><pre>            ]</pre><pre>    }</pre><pre>}</pre><p> </p><p><span style="color: rgb(0,0,0);">This example archives the contents of the </span><span style="color: rgb(0,0,0);">src</span><span style="color: rgb(0,0,0);"> directory and uploads the resulting tgz-file to Cloud Storage. The build request stored in </span><span style="color: rgb(0,0,0);">cloudbuild.yaml</span><span style="color: rgb(0,0,0);"> is then sent to Cloud Build using the credentials for the </span><span style="color: rgb(0,0,0);">my-project</span><span style="color: rgb(0,0,0);"> and with the custom variables </span><code><span style="color: rgb(0,0,0);">_CUSTOM1</span></code><span style="color: rgb(0,0,0);"> and </span><code><span style="color: rgb(0,0,0);">_CUSTOM2</span></code><span style="color: rgb(0,0,0);"> attached to the request.</span></p><p><span style="color: rgb(0,0,0);">The </span><strong><code><span style="color: rgb(0,0,0);">googleCloudBuild</span></code></strong><span style="color: rgb(0,0,0);"> function accepts the following parameters:</span></p><ul><li style="list-style-type: disc;"><p><strong><code>credentialsId</code></strong><span> (required) - the string identifying which credentials (provided by the Google OAuth plugin) to send in the request</span></p></li><li style="list-style-type: disc;"><p><strong><code>request</code></strong><span> (required) - the build request to send to Cloud Build. This must be one of the following:</span></p></li><ul><li style="list-style-type: circle;"><p><strong><code>file(</code></strong><em><code>filename</code><strong><code>)</code></strong></em><span> - sends the contents of </span><span>filename</span><span> as the build request</span></p></li><li style="list-style-type: circle;"><p><strong><code>inline(</code></strong><code><em>request</em></code><strong><code>)</code></strong><span> - sends </span><span>request</span><span> (a YAML or JSON string) as the build request</span></p></li></ul><li style="list-style-type: disc;"><p><strong><code>source</code></strong><span> (optional) - the source to attach to the build request. If provided, this must be one of the following:</span></p></li><ul><li style="list-style-type: circle;"><p><strong><code>local(</code></strong><em><code>path</code><strong><code>)</code></strong></em><span> - archives the contents of path, uploads the resulting tgz to Cloud Storage and uses that as the source in the build request</span></p></li><li style="list-style-type: circle;"><p><strong><code>storage(bucket: </code></strong><code><em>bucket</em></code><strong><code>, object: </code></strong><code><em>object</em></code><strong><code>)</code></strong><span> - uses an existing Cloud Storage object as the source in the build request</span></p></li><li style="list-style-type: circle;"><p><strong><code>repo(projectId: </code></strong><code><em>projectId</em></code><strong><code>, repoName: </code></strong><code><em>repoName</em></code><strong><code>, branch: </code></strong><code><em>branch</em></code><strong><code>, tag: </code></strong><code><em>tag</em></code><strong><code>, commit: </code></strong><code><em>commit</em></code><strong><code>)</code></strong><span> - uses a Cloud Source Repository as the source in the build request. Exactly one of branch, tag, or commit must be specified. The projectId and repoName parameters may be omitted, in which case the same semantics are used as </span><a href="https://cloud.google.com/cloud-build/docs/api/reference/rest/v1/RepoSource" class="external-link" rel="nofollow"><span style="color: rgb(17,85,204);">described in the API documentation</span></a></p></li></ul><li><strong><code><span style="color: rgb(0,0,0);">substitutions</span></code></strong><span style="color: rgb(0,0,0);"> (optional) - a map indicating the custom substitutions to include in the request</span></li></ul>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/135467040/135470204.png">local-source-cropped.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/135467040/135470205.png">storage-source-cropped.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/135467040/135470206.png">repo-source-cropped.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Sep 07, 2021 13:26</p>
                    <div id="footer-logo"><a href="/display/">Wiki home</a></div>
                </section>
            </div>
        </div>     </body>
</html>
