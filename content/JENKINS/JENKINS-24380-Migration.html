<!DOCTYPE html>
<html>
    <head>
        <title>Jenkins : JENKINS-24380 Migration</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Jenkins</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Use-Jenkins.html">Use Jenkins</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Jenkins : JENKINS-24380 Migration
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (kohsuke)</span>, last modified by <span class='editor'> Unknown User (danielbeck)</span> on Dec 29, 2014
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><a href="https://issues.jenkins-ci.org/browse/JENKINS-24380">JENKINS-24380</a>, which is introduced in 1.597, changes the on-disk layout of build directories.</p>

<p>In Jenkins, each job has a directory under <code>$JENKINS_HOME</code> (such as <code>$JENKINS_HOME/jobs/foo/</code> for a job named <code>foo</code>).</p>

<p>Prior to JENKINS-24380, this directory contained one directory each per build named according to its timestamp, such as <code>builds/2014-09-15_17-51-46/</code>, that contains all information about that build (including <code>build.xml</code>, <code>log</code>, and more). If this build was number 123, there was also a symlink (or, on some Windows systems, plain text file) named <code>123</code> that pointed to <code>2014-09-15_17-51-46</code>. <code>build.xml</code> listed the <code>&lt;number&gt;123&lt;/number&gt;</code>; the timestamp (in the local time zone) was implied by the directory name.</p>

<p>After JENKINS-24380, <code>builds/123/</code> will be the directory that contains the build. There is no longer a symlink per build. (Special status symlinks such as <code>lastStableBuild</code> remain as before, still pointing to the build number.) <code>build.xml</code> now indicates the <code>&lt;timestamp&gt;</code>, whereas the number is implied by the directory name.</p>

<p>Whenever a newer version of Jenkins starts with an older <code>$JENKINS_HOME</code>, the necessary conversion happens automatically during startup. Old build records are converted to the new layout, with the exception that <code>build.xml</code> also has an <code>&lt;id&gt;</code> field giving an internal identifier used by some plugins to refer to builds (formerly based on the timestamp, defaulting for new builds to be the number).</p>

<p>This change was introduced to resolve a number of longstanding issues. Unfortunately, this migration is backward incompatible, in that if you upgrade to Jenkins ≥1.597, which migrates the data, then later decide to downgrade back to &lt;1.597, then the earlier version of Jenkins will not know how to interpret the new <code>$JENKINS_HOME</code> directory layout. As a result, Jenkins will come up without any build records.</p>

<p>In case you want to downgrade, there is an “unmigrate” script provided to reverse the migration of <code>$JENKINS_HOME</code>. To do this:</p>

<ol>
	<li>Start Jenkins ≥1.597.</li>
	<li>Visit <code><a class="external-link" href="http://server/jenkins/JENKINS-24380/" rel="nofollow">http://server/jenkins/JENKINS-24380/</a></code> and copy the unmigration instruction.</li>
	<li>Shut down Jenkins completely.</li>
	<li>Run the command as instructed by the step above.</li>
	<li>Start Jenkins &lt;1.597 with the same <code>$JENKINS_HOME</code>.</li>
</ol>
                    </div>

                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Sep 07, 2021 13:08</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
