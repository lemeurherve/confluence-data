<!DOCTYPE html>
<html>
    <head>
        <title>Jenkins : Doktor Plugin</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Jenkins</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Plugins.html">Plugins</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Jenkins : Doktor Plugin
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (madhead)</span>, last modified on Oct 21, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><table class="confluenceTable"><tbody>
<tr>
<th class="confluenceTh"><p> Plugin Information </p></th>
</tr>
<tr>
<td class="confluenceTd"><p> View Doktor <a href="https://plugins.jenkins.io/doktor" class="external-link" rel="nofollow">on the plugin site</a> for more information. </p></td>
</tr>
</tbody></table>
<span style="color: rgb(36,41,46);">Jenkins plugin for automated documentation uploading to Confluence.</span></p><div><div><h2 id="DoktorPlugin-Usage">Usage</h2><div><div><h3 id="DoktorPlugin-Features"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#features" rel="nofollow"></a>Features</h3><div><h4 id="DoktorPlugin-Supportedformats"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#supported-formats" rel="nofollow"></a>Supported formats</h4><div><p>Doktor supports <a href="https://daringfireball.net/projects/markdown/syntax" class="external-link" rel="nofollow">Markdown</a> and <a href="http://asciidoc.org/" class="external-link" rel="nofollow">AsciiDoc</a>. Markdown support is provided by awesome <a href="https://github.com/vsch/flexmark-java" class="external-link" rel="nofollow">flexmark-java</a> library. AsciiDoc is supported thanks to <a href="https://github.com/asciidoctor/asciidoctorj" class="external-link" rel="nofollow">AsciidoctorJ</a>. Please note that AsciiDoc support is very experimental.</p></div></div><div><h4 id="DoktorPlugin-Frontmatter"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#front-matter" rel="nofollow"></a>Front matter</h4><div><p><em>Front matter</em> is another word for <em>metadata</em>, used by bloggers and hipsters widely. Doktor uses front matter to configure the way pages appear in Confluence.</p></div><div><h5 id="DoktorPlugin-Markdown"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#markdown" rel="nofollow"></a>Markdown</h5><div><p>Doktor supports <a href="http://www.yaml.org/" class="external-link" rel="nofollow">YAML</a> front matter in your Markdown files. Front matter looks like a small YAML fragment at the beginning of the file, separated by a triple minus sign (<code>---</code>) in this case:</p></div><div><div><div class="highlight highlight-source-yaml"><pre>---
<span class="pl-ent" style="color: rgb(34,134,58);">key</span>: <span class="pl-s" style="color: rgb(3,47,98);">value</span>
---</pre></div></div></div></div><div><h5 id="DoktorPlugin-AsciiDoc"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#asciidoc" rel="nofollow"></a>AsciiDoc</h5><div><p>Doktor supports <a href="http://www.yaml.org/" class="external-link" rel="nofollow">YAML</a> front matter in your AsciiDoc files as well. Front matter looks like a small YAML fragment at the beginning of the file, separated by a triple minus sign (<code>---</code>) in this case. Note, that due to a more strict YAML parser logic for AsciiDoc, strings with special characters need to be quoted:</p></div><div><div><div class="highlight highlight-text-html-asciidoc"><pre><span class="pl-ms" style="color: rgb(0,92,197);">---</span>
key: value
key_with_specials: 'value: with specials'
---</pre></div></div></div></div><div><h5 id="DoktorPlugin-Supportedfrontmatterattributes:"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#supported-front-matter-attributes" rel="nofollow"></a>Supported front matter attributes:</h5><div><p>titleRequired. Page title, unsurprisingly.parentOptional. Parent page title, if any. If omitted, &quot;orphaned&quot; page will be created. If parent page is not found by title, child page will not be created at all.labelsOptional. List of labels to add to a page.</p></div></div></div><div><h4 id="DoktorPlugin-Tables"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#tables" rel="nofollow"></a>Tables</h4><div><h5 id="DoktorPlugin-Markdown.1"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#markdown-1" rel="nofollow"></a>Markdown</h5><div><p>Though Markdown does not have any support for tables, Doktor supports <a href="https://help.github.com/articles/organizing-information-with-tables" class="external-link" rel="nofollow">GitHub Flavored Markdown tables</a>. You can also create tables by inlining XHTML markup directly in your docs.</p></div></div><div><h5 id="DoktorPlugin-AsciiDoc.1"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#asciidoc-1" rel="nofollow"></a>AsciiDoc</h5><div><p>AsciiDoc (thus Asciidoctor and AsciidoctorJ) <a href="http://asciidoctor.org/docs/user-manual/#tables" class="external-link" rel="nofollow">supports tables natively</a>.</p></div></div></div><div><h4 id="DoktorPlugin-Images"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#images" rel="nofollow"></a>Images</h4><div><p>Doktor supports images. When an image is referred by relative URL it will be uploaded to a Confluence server as an attachment of a page, given unique name. When an image is referred by remote URL (Internet link) it will be referred by this URL from a Confluence server.</p></div><div><h5 id="DoktorPlugin-Markdown.2"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#markdown-2" rel="nofollow"></a>Markdown</h5><div><p><a href="https://daringfireball.net/projects/markdown/syntax#img" class="external-link" rel="nofollow">Markdown syntax</a> for images:</p></div><div><div><div class="highlight highlight-source-gfm"><pre>![<span class="pl-e" style="color: rgb(111,66,193);">Millennium Falcon</span>](./millennium_falcon.png &quot;The Millennium Falcon, Han Solo's most prized possession&quot;)</pre></div></div></div></div><div><h5 id="DoktorPlugin-AsciiDoc.2"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#asciidoc-2" rel="nofollow"></a>AsciiDoc</h5><div><p>Images look like <a href="http://asciidoctor.org/docs/asciidoc-writers-guide/#images" class="external-link" rel="nofollow">this</a> is AsciiDoc:</p></div><div><div><div class="highlight highlight-text-html-asciidoc"><pre><span class="pl-mh" style="color: rgb(0,92,197);">.The Millennium Falcon, Han Solo's most prized possession</span>
<span class="pl-mh" style="color: rgb(0,92,197);">[link=http://starwars.wikia.com/wiki/Millennium_Falcon]</span>
<span class="pl-s" style="color: rgb(3,47,98);">image::./millennium_falcon.png[Millennium Falcon,400,float=&quot;right&quot;,align=&quot;center&quot;]</span></pre></div></div></div><div><p>As you see, AsciiDoc is more feature-rich.</p></div></div></div><div><h4 id="DoktorPlugin-Diagrams"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#diagrams" rel="nofollow"></a>Diagrams</h4><div><p>Diagrams are only supported in AsciiDoc, the markup looks like this:</p></div><div><div><pre>seqdiag {
  // normal edge and doted edge
  A -&gt; B [label = &quot;normal edge&quot;];
  B --&gt; C [label = &quot;dotted edge&quot;];

  B &lt;-- C [label = &quot;return dotted edge&quot;];
  A &lt;- B [label = &quot;return edge&quot;];

  // asynchronus edge
  A -&gt;&gt; B [label = &quot;asynchronus edge&quot;];
  B --&gt;&gt; C [label = &quot;asynchronus dotted edge&quot;];

  B &lt;&lt;-- C [label = &quot;return asynchronus doted edge&quot;];
  A &lt;&lt;- B [label = &quot;return asynchronus edge&quot;];

  // self referenced edge
  A -&gt; A [label = &quot;self reference edge&quot;];
}</pre></div></div><div><p>The snippet above will be rendered in this image:</p></div><div><div><a href="https://github.com/madhead/doktor/blob/master/.github/images/seqdiag.png" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="seqdiag" src="https://github.com/madhead/doktor/raw/master/.github/images/seqdiag.png" data-image-src="https://github.com/madhead/doktor/raw/master/.github/images/seqdiag.png"></span></a></div></div><div><p>Read more about diagram syntax in <a href="http://asciidoctor.org/docs/asciidoctor-diagram" class="external-link" rel="nofollow">in the official AsciiDoc guide</a>. Be warned, that most types of diagrams require external tools (like <code>seqdiag</code> or <code>dot</code>) to be installed and available on the <code>PATH</code>.</p></div><div><p>Currently, these diagrams are supported:</p></div><div><ul><li><p><code>actdiag</code> / <code>blockdiag</code> / <code>nwdiag</code> / <code>packetdiag</code> / <code>rackdiag</code> / <code>seqdiag</code>. These diagrams require <a href="http://blockdiag.com/" class="external-link" rel="nofollow"><code>blockdiag</code></a> and related Python packages to be available on the <code>PATH</code>.</p></li><li><p><a href="http://ditaa.sourceforge.net/" class="external-link" rel="nofollow"><code>ditaa</code></a>. No additional tools needed.</p></li><li><p><code>graphviz</code>. Obviously, requires <a href="http://www.graphviz.org/" class="external-link" rel="nofollow">Graphviz</a> tool to be on the <code>PATH</code>.</p></li><li><p><code>mermaid</code> Requires <a href="https://mermaidjs.github.io/" class="external-link" rel="nofollow">mermaid</a> (version prior to <code>7.x</code>) and <a href="http://phantomjs.org/" class="external-link" rel="nofollow">PhantomJS</a> to be on the <code>PATH</code>.</p></li><li><p><a href="http://plantuml.com/" class="external-link" rel="nofollow"><code>plantuml</code></a> No additional tools needed.</p></li></ul></div></div></div><div><h3 id="DoktorPlugin-ConfigureConfluenceservers"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#configure-confluence-servers" rel="nofollow"></a>Configure Confluence servers</h3><div><p>As you might suspect, Confluence REST API requires authentication. Doktor supports basic authentication (username and password). So, first thing to do is to <a href="https://github.com/jenkinsci/credentials-plugin/blob/master/docs/user.adoc" class="external-link" rel="nofollow">configure credentials</a> in Jenkins.</p></div><div><p>Create a &quot;Username with password&quot; credentials to be used to authenticate on Confluence server:</p></div><div><div><a href="https://github.com/madhead/doktor/blob/master/.github/images/new_credentials.png" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="new credentials" src="https://github.com/madhead/doktor/raw/master/.github/images/new_credentials.png" data-image-src="https://github.com/madhead/doktor/raw/master/.github/images/new_credentials.png"></span></a></div></div><div><p>You may have as many Confluence servers and credentials for them as you need.</p></div><div><p>Next thing to do is to configure Confluence servers. Go to global configuration screen (&quot;Manage Jenkins&quot; → &quot;Configure System&quot;) and find &quot;Confluence Servers&quot; section. Configure the list of available Confluence servers:</p></div><div><div><a href="https://github.com/madhead/doktor/blob/master/.github/images/confluence_servers.png" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="confluence servers" src="https://github.com/madhead/doktor/raw/master/.github/images/confluence_servers.png" data-image-src="https://github.com/madhead/doktor/raw/master/.github/images/confluence_servers.png"></span></a></div></div><div><p>Now, when you have some Confluence servers to publish documentation to, it’s time test this plugin! Yes, I’m using word &quot;test&quot; <a href="https://github.com/madhead/doktor/issues/new" class="external-link" rel="nofollow">intentionally</a> here.</p></div></div><div><h3 id="DoktorPlugin-Pipelinestep"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#pipeline-step" rel="nofollow"></a>Pipeline step</h3><div><p>Using Doktor with <a href="https://jenkins.io/doc/book/pipeline" class="external-link" rel="nofollow">pipelines</a> is very easy! Here is the full syntax of <code>doktor</code> step:</p></div><div><div><div class="highlight highlight-source-groovy"><pre>doktor
	<span class="pl-c1" style="color: rgb(0,92,197);">server</span> : <span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">'</span>Cantina<span class="pl-pds">'</span></span>, (<span class="pl-c1" style="color: rgb(0,92,197);">1</span>)
	<span class="pl-c1" style="color: rgb(0,92,197);">markdownIncludePatterns</span>: [<span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">'</span>glob:**.md<span class="pl-pds">'</span></span>], (<span class="pl-c1" style="color: rgb(0,92,197);">2</span>)
	<span class="pl-c1" style="color: rgb(0,92,197);">markdownExcludePatterns</span>: [<span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">'</span>glob:README.md<span class="pl-pds">'</span></span>], (<span class="pl-c1" style="color: rgb(0,92,197);">3</span>)
	<span class="pl-c1" style="color: rgb(0,92,197);">asciidocIncludePatterns</span>: [<span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">'</span>glob:**.adoc<span class="pl-pds">'</span></span>, <span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">'</span>glob:**.asc<span class="pl-pds">'</span></span>], (<span class="pl-c1" style="color: rgb(0,92,197);">4</span>)
	<span class="pl-c1" style="color: rgb(0,92,197);">asciidocExcludePatterns</span>: [<span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">'</span>glob:LICENSE.adoc<span class="pl-pds">'</span></span>, <span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">'</span>glob:CONTRIBUTING.asc<span class="pl-pds">'</span></span>] (<span class="pl-c1" style="color: rgb(0,92,197);">5</span>)</pre></div></div></div><div><ol><li><p>One of the available Confluence servers</p></li><li><p>List of Java 8 <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-" class="external-link" rel="nofollow">PathMatcher specifications</a> for <a href="https://daringfireball.net/projects/markdown/syntax" class="external-link" rel="nofollow">Markdown</a> files to include.</p></li><li><p>List of Java 8 <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-" class="external-link" rel="nofollow">PathMatcher specifications</a> for <a href="https://daringfireball.net/projects/markdown/syntax" class="external-link" rel="nofollow">Markdown</a> files to exclude.</p></li><li><p>List of Java 8 <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-" class="external-link" rel="nofollow">PathMatcher specifications</a> for <a href="http://asciidoc.org/" class="external-link" rel="nofollow">AsciiDoc</a> files to include.</p></li><li><p>List of Java 8 <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-" class="external-link" rel="nofollow">PathMatcher specifications</a> for <a href="http://asciidoc.org/" class="external-link" rel="nofollow">AsciiDoc</a> files to exclude.</p></li></ol></div><div><p>You can also try your luck with &quot;Snippet Generator&quot;, available at <code>/pipeline-syntax</code> path of your Jenkins installation.</p></div></div><div><h3 id="DoktorPlugin-Classicbuilds"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#classic-builds" rel="nofollow"></a>Classic builds</h3><div><p>Doktor plays nice with &quot;classic&quot; builds too!</p></div><div><div><a href="https://github.com/madhead/doktor/blob/master/.github/images/freestyle_config.png" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="freestyle config" src="https://github.com/madhead/doktor/raw/master/.github/images/freestyle_config.png" data-image-src="https://github.com/madhead/doktor/raw/master/.github/images/freestyle_config.png"></span></a></div></div><div><p>Click those question icons on the right if you need any help.</p></div></div></div></div><div><h2 id="DoktorPlugin-Limitations"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#limitations" rel="nofollow"></a>Limitations</h2><div><div><p>Doktor recreates pages instead of updating them. Recreating pages has some counterintuitive effects:</p></div><div><ul><li><p>Any modification will overridden on each Doktor run, obviously</p></li><li><p>Page likes are not preserved</p></li><li><p>Attachments are not preserved</p></li><li><p>There is no support for extra Confluence markup, macroses and features like comments</p></li></ul></div><div><p>This may sound shocking to you, but let me explain.</p></div><div><p>Doktor’s idea is just uploading your documentation somewhere, making it available to <em>read</em> by everybody. Doktor is not about collaborative editing - use VCS for that. It’s a unidirectional flow - from sources to rendered documents - by design. I was inspired by GitHub’s <a href="https://pages.github.com/" class="external-link" rel="nofollow">pages</a> and <a href="https://help.github.com/articles/about-github-wikis" class="external-link" rel="nofollow">wikis</a>, and I sincerely believe in this approach.</p></div><div><p>At the moment, Doktor supports only Confluence and may never support any other services (unless my employer switches to another vendor).</p></div></div></div><div><h2 id="DoktorPlugin-Developing"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#developing" rel="nofollow"></a>Developing</h2><div><div><p>Doktor is built with <a href="https://kotlinlang.org/" class="external-link" rel="nofollow">Kotlin</a>, <a href="https://gradle.org/" class="external-link" rel="nofollow">Gradle</a> and Love. Well, actually with hate to the workflows on my day-time job.</p></div><div><p>JPI artifact is produced with <a href="https://github.com/jenkinsci/gradle-jpi-plugin" class="external-link" rel="nofollow">Gradle’s JPI plugin</a>. Read its documentation to know more about supported features and options.</p></div><div><p>Also, take a look at <a href="https://github.com/SimpleFinance/jenkins-firebase-test-plugin" class="external-link" rel="nofollow">this awesome Jenkins plugin</a>, which is build with Gradle and Kotlin too!</p></div><div><h3 id="DoktorPlugin-Building&amp;running"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#building--running" rel="nofollow"></a>Building &amp; running</h3><div><p>Basically, <code>./gradlew --rerun-tasks clean jpi server</code> will spin up a Jenkins with Doktor installed. <code>--rerun-tasks</code> is used to force clean build every time because Gradle aggressively caches build outputs, especially <a href="https://kotlinlang.org/docs/reference/kapt.html" class="external-link" rel="nofollow">Kotlin annotation processing tool</a> results. Feel free to tweak CLI arguments, assuming you know what you do.</p></div><div><p>Debug is supported as well:</p></div><div><div><div class="highlight highlight-source-shell"><pre>GRADLE_OPTS=<span class="pl-s" style="color: rgb(3,47,98);"><span class="pl-pds">&quot;</span>-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005<span class="pl-pds">&quot;</span></span> ./gradlew --rerun-tasks clean jpi server</pre></div></div></div><div><p>Omit <code>server</code> task if you just need a JPI file.</p></div></div><div><h3 id="DoktorPlugin-Testingonremoteagents"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#testing-on-remote-agents" rel="nofollow"></a>Testing on remote agents</h3><div><p>Once you may want to test how Doktor behaves on agents. The simplest way to do that is to run an agent in Docker. There are two images for agents available.</p></div><div><h4 id="DoktorPlugin-jenkinsci/slave"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#jenkinscislave" rel="nofollow"></a>jenkinsci/slave</h4><div><p><a href="https://hub.docker.com/r/jenkinsci/slave" class="external-link" rel="nofollow">jenkinsci/slave</a> is an image meant to be run by Jenkins to start a new agent. The configuration is very simple:</p></div><div><div><a href="https://github.com/madhead/doktor/blob/master/.github/images/slave.png" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="slave" src="https://github.com/madhead/doktor/raw/master/.github/images/slave.png" data-image-src="https://github.com/madhead/doktor/raw/master/.github/images/slave.png"></span></a></div></div><div><p>When you’re running Jenkins via Gradle JPI plugin it will be run under you user account, so either your user needs to be able to execute <code>sudo docker</code> without password or you will need to type that password in Gradle’s terminal session.</p></div></div><div><h4 id="DoktorPlugin-jenkinsci/ssh-slave"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#jenkinscissh-slave" rel="nofollow"></a>jenkinsci/ssh-slave</h4><div><p><a href="https://hub.docker.com/r/jenkinsci/ssh-slave" class="external-link" rel="nofollow">jenkinsci/ssh-slave</a> is another (better) option. It allows you manage agent container separately and then attach it to Jenkins, thus eliminating the need to provide any password or execute <code>sudo docker</code>. Container’s mounts and FS modifications will be preserved between Jenkins restarts.</p></div><div><p>First, you need to have an SSH key pair that will be used to connect to the agent. Looks like only RSA keys are supported (public key must start with <code>ssh-</code> prefix). Either <a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" class="external-link" rel="nofollow">create a new one</a>, or use the existing.</p></div><div><p>Then, install <a href="https://wiki.jenkins.io/display/JENKINS/SSH+Slaves+plugin" rel="nofollow">SSH Slaves plugin</a> on the master.</p></div><div><p>Create new &quot;SSH Username with private key&quot; credentials:</p></div><div><div><a href="https://github.com/madhead/doktor/blob/master/.github/images/ssh_slave_credentials.png" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="ssh slave credentials" src="https://github.com/madhead/doktor/raw/master/.github/images/ssh_slave_credentials.png" data-image-src="https://github.com/madhead/doktor/raw/master/.github/images/ssh_slave_credentials.png"></span></a></div></div><div><p>You can paste private key directly here or use one of the defaults (<code>~/.ssh/id_ecdsa</code>, <code>~/.ssh/id_rsa</code>, <code>~/.ssh/id_dsa</code>, <code>~/.ssh/identity</code>).</p></div><div><p>Next, start agent container by executing <code>docker run --detach --name jenkins-slave jenkinsci/ssh-slave &quot;$(cat ~/.ssh/jenkins.pub)&quot;</code> (assuming that <code>~/.ssh/jenkins.pub</code> is a public key corresponding to the private key from previous step).</p></div><div><p>Finally, create new agent with a configuration like this:</p></div><div><div><a href="https://github.com/madhead/doktor/blob/master/.github/images/ssh_slave.png" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" alt="ssh slave" src="https://github.com/madhead/doktor/raw/master/.github/images/ssh_slave.png" data-image-src="https://github.com/madhead/doktor/raw/master/.github/images/ssh_slave.png"></span></a></div></div><div><p><code>172.17.0.2</code> here is the IP of a Docker contaner from the previous step, <a href="https://stackoverflow.com/a/20686101/750510" class="external-link" rel="nofollow">found in <code>docker inspect</code> output</a>. You could also run the container exposing the ports (e.g. <code>-p 2222:22</code>) and then use <code>localhost</code> as host and <code>2222</code> as port.</p></div></div></div><div><h3 id="DoktorPlugin-TestingConfluenceintegration"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#testing-confluence-integration" rel="nofollow"></a>Testing Confluence integration</h3><div><p>You’ll need to refer to Confluence REST API. <a href="https://docs.atlassian.com/confluence/REST/latest" class="external-link" rel="nofollow">Here</a> is the link. <a href="https://developer.atlassian.com/confdev/confluence-server-rest-api/confluence-rest-api-examples" class="external-link" rel="nofollow">Samples</a> are also available.</p></div><div><h4 id="DoktorPlugin-Cloud"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#cloud" rel="nofollow"></a>Cloud</h4><div><p>Probably, the easiest (and CPU / RAM saving) way to run Confluence is to run it in the cloud (AWS EC2, DigitalOcean, …). Though, it will cost you some money.</p></div><div><p>There is an <a href="https://github.com/jenkinsci/doktor-plugin/blob/master/.ansible/confluence.yml" class="external-link" rel="nofollow">Ansible script</a> in this repo to automate Confluence installation. It assumes that you already have a running instance that meets <a href="https://confluence.atlassian.com/doc/system-requirements-126517514.html" class="external-link" rel="nofollow">Confluence’s minimal system requirements</a>. Read your cloud provider’s documentation to know how to create and manageVMs.</p></div><div><p>When you have a VM, just follow these steps to install Confluence Server:</p></div><div><ol><li><p>Create inventory file (<code>.ansible/inventory</code>) with a content like this:</p><div><div><div class="highlight highlight-source-ini"><pre><span class="pl-en" style="color: rgb(111,66,193);">[confluence]</span>
your.confluence.host</pre></div></div></div><div><p>You might want to add additional parameters. For example, a set of parameters for Ubuntu 16.04 EC2 instance:</p></div><div><div><div class="highlight highlight-source-ini"><pre><span class="pl-en" style="color: rgb(111,66,193);">[confluence]</span>
your.confluence.host <span class="pl-k" style="color: rgb(215,58,73);">ansible_user</span>=ubuntu <span class="pl-k" style="color: rgb(215,58,73);">ansible_ssh_private_key_file</span>=~/.ssh/confluence.pem <span class="pl-k" style="color: rgb(215,58,73);">ansible_python_interpreter</span>=/usr/bin/python3</pre></div></div></div><div><p>Or you can just use <a href="http://docs.ansible.com/ansible/latest/intro_dynamic_inventory.html" class="external-link" rel="nofollow">dynamic inventories</a>.</p></div></li><li><p>Install required roles from <a href="https://galaxy.ansible.com/" class="external-link" rel="nofollow">Ansible Galaxy</a>: <code>sudo ansible-galaxy install -r requirements.yml --force</code>.</p></li><li><p>After the inventory is configured, just run <code>./confluence.yml</code> from the <code>.ansible</code> directory.</p></li><li><p>Go to <code><a href="http://your.confluence.host/" class="external-link" rel="nofollow">http://your.confluence.host/</a></code> (if the DNS and IPs are set) and configure the instance. Note, that you will need a license key (trial works for 90 days).</p></li></ol></div></div><div><h4 id="DoktorPlugin-Docker"><a class="external-link" style="" href="https://github.com/jenkinsci/doktor-plugin/blob/master/README.adoc#docker" rel="nofollow"></a>Docker</h4><div><p>You can run Confluence locally as well. The easiest way here is <a href="https://www.docker.com/" class="external-link" rel="nofollow">Docker</a> (Windows uses should appreciate the joke).</p></div><div><p>Running Confluence is as simple as:</p></div><div><div><div class="highlight highlight-source-shell"><pre>docker volume create --name confluence-data
docker run --detach --volume confluence-data:/var/atlassian/application-data/confluence --name confluence --publish-all atlassian/confluence-server:latest</pre></div></div></div><div><p>You might want to add some <a href="https://docs.docker.com/engine/reference/run" class="external-link" rel="nofollow">additional options</a> or tweak the existing ones.</p></div><div><p>Note, that you will need a license key (trial works for 90 days).</p></div></div></div></div></div></div>
                    </div>

                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Sep 07, 2021 13:21</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
