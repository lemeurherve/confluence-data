<!DOCTYPE html>
<html>
    <head>
        <title>Jenkins : Anchore Container Image Scanner Plugin</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Jenkins</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Plugins.html">Plugins</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Jenkins : Anchore Container Image Scanner Plugin
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (nurmi)</span>, last modified by <span class='editor'> Unknown User (swathigangisetty)</span> on May 24, 2018
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><table class="confluenceTable"><tbody>
<tr>
<th class="confluenceTh"><p> Plugin Information </p></th>
</tr>
<tr>
<td class="confluenceTd"><p> View Anchore Container Image Scanner <a href="https://plugins.jenkins.io/anchore-container-scanner" class="external-link" rel="nofollow">on the plugin site</a> for more information. </p></td>
</tr>
</tbody></table>

<div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Older versions of this plugin may not be safe to use. Please review the following warnings before using an older version:</p>

<ul>
	<li><a href="https://jenkins.io/security/advisory/2018-07-30/#SECURITY-1039" class="external-link" rel="nofollow">Password stored in plain text</a></li>
	<li><a href="https://jenkins.io/security/advisory/2019-11-21/#SECURITY-1539" class="external-link" rel="nofollow">Credentials stored in plain text</a></li>
</ul>

</div></div>
</p><h1 id="AnchoreContainerImageScannerPlugin-Description">Description</h1><p>Anchore is a container inspection and analytics platform that enables operators to analyze, inspect, perform security scans, and evaluate custom policies against container images. The Anchore plugin can be used in a Pipeline job or added as a build step to a Freestyle job to automate the process of running an anchore analysis, evaluating custom anchore policies against images, and performing image anchore security scans. </p><h1 id="AnchoreContainerImageScannerPlugin-AnchoreJenkinsPlugin">Anchore Jenkins Plugin</h1><p>Anchore has been designed to plug seamlessly into the CI/CD workflow. A developer commits code into the source code management system. This change triggers Jenkins to start a build which creates a container image.</p><p>In the typical workflow this container image is then run through automated testing. If an image does not meet your organization’s requirements for security or compliance then it makes little sense to invest the time required to perform automated tests on the image, it would be better to “learn fast” by failing the build and returning the appropriate reports back to the developer to allow the issue to be addressed.</p><p> </p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" height="250" width="863" src="attachments/101482571/138456617.png" data-image-src="attachments/101482571/138456617.png" data-unresolved-comment-count="0" data-linked-resource-id="138456617" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image_1.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span><span style="color: rgb(210,73,57);"> </span></p><h2 id="AnchoreContainerImageScannerPlugin-PluginModes"><span style="color: rgb(210,73,57);">Plugin Modes</span></h2><p>Before getting started, one of two plugin operating 'modes' must be selected. Selecting a mode will configure the plugin to either use a direct anchore scanner (which must be installed on each Jenkins worker node), or a second mode which configures the plugin to interact with the Anchore Engine service API (where the Anchore engine has been installed with its service API accessible from the worker nodes). Depending on which mode you select, the initial configuration/usage will differ.</p><h3 id="AnchoreContainerImageScannerPlugin-AnchoreEngineMode(recommended)">Anchore Engine Mode (recommended)</h3><p>In this mode, the usage model generally conforms to the following flow:</p><ol><li>A Jenkins job will build a container image, and push the image to a registry that is pre-configured in the anchore engine service (see pre-requisites below)</li><li>The anchore build step will interact with the anchore engine by 'adding' the image (which instructs the anchore engine to pull the image from the registry), and then performing a policy evaluation check on the image. The build step can optionally be configured to fail the build if the policy evaluation results in a 'STOP' action.</li><li>the plugin will store the resulting policy evaluation results with the job, for later inspection/review</li></ol><p>The plugin can be used in Freestyle and Pipeline jobs.</p><h5 id="AnchoreContainerImageScannerPlugin-Pre-Requisites:">Pre-Requisites:</h5><ol><li>The anchore engine service must be installed within your environment, with its service API being accessible from all Jenkins workers. See <a href="https://github.com/anchore/anchore-engine" class="external-link" rel="nofollow">https://github.com/anchore/anchore-engine</a> to get started </li><li>A docker registry must exist and be configured within anchore engine, as the plugin will be instructing the anchore engine to pull images from a registry in this mode.</li><li>All authentication credentials/anchore engine API endpoint information must be available as input to the plugin at configuration time.</li></ol><h3 id="AnchoreContainerImageScannerPlugin-AnchoreLocalMode(deprecated)">Anchore Local Mode <span style="color: rgb(226,80,65);"><strong>(deprecated)</strong></span></h3><p>Local mode is deprecated and is included for backwards compatibility. Future releases of the Anchore Jenkins plugin will remove support for Local Mode. All new deployments should use <em>Engine</em><em> Mode. </em>The following installation instructions covers the installation and configuration of the Anchore Jenkins plugin in Engine mode.</p><p>In this mode, the usage model generally conforms to the following flow:</p><ol><li>A Jenkins job will build a container image on some worker node, and the name of the locally available image is written to a file (default anchore_images)</li><li>The anchore build step will read the images from the anchore_images file and perform analysis/policy evaluation, by calling out to a locally running container with anchore pre-installed (see pre-requisites in the guide linked below). The build step can optionally be configured to fail the build if the policy evaluation results in a 'STOP' action.</li><li>The plugin will store the resulting policy evaluation and image query results with the job, for later inspection/review</li></ol><h5 id="AnchoreContainerImageScannerPlugin-Pre-Requisites:.1">Pre-Requisites:</h5><ol><li>Jenkins installed and configured either as a single system, or with multiple configured jenkins worker nodes</li><li>Each host on which jenkins jobs will run must have docker installed and the jenkins user (or whichever user you have configured jenkins to run jobs as) must be allowed to interact with docker (either directly or via sudo)</li><li>Each host on which jenkins jobs will run must have the latest anchore container image installed in the local docker host. To install, run 'docker pull anchore/jenkins:latest' on each jenkins host to make the image available to the plugin. The plugin will start an instance of the anchore/jenkins:latest docker container named 'jenkins_anchore' by default, on each host that runs a jenkins job that includes an anchore container image scanner build step.</li></ol><p>Once installed, one of two 'modes' must be selected (Manage Jenkins -&gt; Configure System -&gt; Anchore Plugin Mode), which will configure the plugin to either use a direct anchore scanner (which must be installed on each Jenkins worker node), or a second mode which configures the plugin to interact with the anchore engine service API (where the anchore engine has been installed with its service API accessible from the worker nodes). Depending on which mode you select, the initial configuration/usage will differ.</p><h1 id="AnchoreContainerImageScannerPlugin-Installation">Installation</h1><p>The Anchore plugin has been published in the Jenkins plugin registry and is available for installation on any Jenkins server.<br/><br/>From the main Jenkins menu select Manage Jenkins</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="250" width="190" src="attachments/101482571/138456618.png" data-image-src="attachments/101482571/138456618.png" data-unresolved-comment-count="0" data-linked-resource-id="138456618" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image_2.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></p><p>Next select Manage Plugins</p><div><strong><span><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="250" width="388" src="attachments/101482571/138456619.png" data-image-src="attachments/101482571/138456619.png" data-unresolved-comment-count="0" data-linked-resource-id="138456619" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image_3.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></span></strong></div><div><strong><span><br/></span></strong></div><div>Click on the <em>Available</em> tab and scroll down to select “Anchore Container Image Scanner Plugin” and click on “Install without restart”</div><div><strong><span><strong><span><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="250" width="516" src="attachments/101482571/138456620.png" data-image-src="attachments/101482571/138456620.png" data-unresolved-comment-count="0" data-linked-resource-id="138456620" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image_4.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></span></strong></span></strong></div><div><strong><span><strong><span><br/></span></strong></span></strong></div><div><h1 id="AnchoreContainerImageScannerPlugin-Configuration">Configuration</h1><p>From the Manage Jenkins menu select Configure System</p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="250" width="467" src="attachments/101482571/138456621.png" data-image-src="attachments/101482571/138456621.png" data-unresolved-comment-count="0" data-linked-resource-id="138456621" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image_5.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span><br/></strong></p><div><p><span>Scroll down to the <strong>Anchore Configuration</strong> section</span></p><ul><li><span>Ensure that <em>Enable Anchore Scanning</em> is enabled</span></li><li><span>Select <em>Engine Mode</em></span></li><li><span> </span>Update <em>Engine URL</em> to point to the Anchore Engine<br/>Note: Ensure that the /v1 route is included in the URL</li><li>Enter <em>Engine Username</em>.<br/>eg. Admin</li><li>Enter <em>Engine Password</em></li></ul><p>If the Anchore Engine uses a user created certificate that is not signed by a standard certificate authority then select uncheck <em>Verify SSL</em></p><p><em><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="245" width="1020" src="attachments/101482571/138456622.png" data-image-src="attachments/101482571/138456622.png" data-unresolved-comment-count="0" data-linked-resource-id="138456622" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image_17.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></em></p><p><em><br/></em></p></div></div><div><h1 id="AnchoreContainerImageScannerPlugin-AddingAnchoreScanningtoJenkinsBuild">Adding Anchore Scanning to Jenkins Build</h1><p>The Anchore plugin can be added a build step for a Freestyle or Pipeline build. Typically the flow is as follows.</p><p>A Jenkins job will:</p><ol><li>Build a container image</li><li>Push the image to a Docker Registry, typically a staging registry for QA</li><li>Use Anchore Plugin in a Pipeline job or add Anchore Container Image Scanner build step to a Freestyle job to instruct the Anchore Engine to analyze the image<ol><li>The Anchore Engine downloads (pulls) the image layers from the staging registry</li><li>The Anchore Engine performs analysis on the image</li><li>The Anchore Engine performs a policy evaluation on the image.</li></ol></li><li>The Anchore Plugin polls the Anchore Engine for a user defined period until the analysis and policy evaluation is complete</li><li>Based on user configuration, the Anchore Plugin may fail the build in the case of a Policy violation or allow the built to continue with warnings.</li></ol><p>When run, the Anchore Plugin will look for a file named <em>anchore_images</em> in the project workspace. This file should contain the name(s) of containers to be scanned and optionally include the Dockerfile. </p><h2 id="AnchoreContainerImageScannerPlugin-Freestyle"><span style="color: rgb(210,73,57);">Freestyle </span></h2><p>In the example below an <em>Execute Shell</em> build step is used to build and push a container image to a local registry.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: bash; gutter: false; theme: Emacs" data-theme="Emacs">TAG=$(date &quot;+%H%M%S%d%m%Y&quot;)
IMAGENAME=build.example.com/myapp
docker build -t $IMAGENAME:$TAG .
docker push $IMAGENAME:$TAG</pre>
</div></div><p> </p></div><div><p>We will add a single line to create the <em>anchore_images</em> file that is read by the Anchore Plugin</p><p>Note: Multiple lines can be added if the build produces more than a single container image.</p></div><div><p> </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: bash; gutter: false; theme: Emacs" data-theme="Emacs">TAG=$(date &quot;+%H%M%S%d%m%Y&quot;)
IMAGENAME=build.example.com/myapp
docker build -t $IMAGENAME:$TAG .
docker push $IMAGENAME:$TAG

# Line added to create anchore_images file
echo &quot;$IMAGENAME:$TAG ${WORKSPACE}/Dockerfile &quot; &gt; anchore_images</pre>
</div></div><p>After the image has been built and pushed to the staging registry the Anchore Scanner should be called. </p><p>Dropdown <em>Add build step</em> and select the <em>Anchore Container Image Scanner</em></p><p><em><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="250" width="295" src="attachments/101482571/138456623.png" data-image-src="attachments/101482571/138456623.png" data-unresolved-comment-count="0" data-linked-resource-id="138456623" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image_9.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></em></p><p><span style="color: rgb(24,50,71);">A new build step labeled </span><strong>Anchore Build Options</strong><span style="color: rgb(24,50,71);"> will appear in your job.</span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="150" src="attachments/101482571/138456639.png" data-image-src="attachments/101482571/138456639.png" data-unresolved-comment-count="0" data-linked-resource-id="138456639" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="meh.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh"><span style="color: rgb(24,50,71);">Option</span></th><th class="confluenceTh"><span style="color: rgb(24,50,71);">Description</span></th></tr><tr><td class="confluenceTd"><span style="color: rgb(24,50,71);">Image list file</span></td><td class="confluenceTd"><span style="color: rgb(24,50,71);">Name of the file, present in workspace that contains the image name and optionally Dockerfile location</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(24,50,71);">Fail build on policy check STOP result</span></td><td class="confluenceTd"><span style="color: rgb(24,50,71);">If the Anchore Engine policy evaluate returns a fail (STOP) then the Jenkins job should be failed. If this is not selected then a failed policy evaluation will allow the build to continue.</span></td></tr><tr><td class="confluenceTd"><span style="color: rgb(24,50,71);">Fail build on critical plugin error</span></td><td class="confluenceTd"><span style="color: rgb(24,50,71);">If selected and the Anchore Plugin experiences a critical error the the build will be failed. This is typically used to ensure that a fault with the Anchore Engine (eg. service not available) does not permit a failing image to be promoted to production.</span></td></tr><tr><td colspan="1" class="confluenceTd"><span style="color: rgb(24,50,71);">AnchoreEngine operation retries</span></td><td colspan="1" class="confluenceTd"><span style="color: rgb(24,50,71);">How long in seconds the Anchore Plugin waits until timing out image analysis.</span><br/><span style="color: rgb(24,50,71);">The Plugin will continue operation once the image has been analyzed but will time out if this period is exceeded.</span></td></tr></tbody></table></div><p>The Anchore Plugin creates an Anchore Report directory that includes a JSON file including the results of the policy evaluation.</p><p>The Plugin renders this in the Jenkins UI showing the status of the build (GO = Pass, STOP = Fail, WARN=Warning)</p><p><span style="color: rgb(24,50,71);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="250" width="443" src="attachments/101482571/138456624.jpeg" data-image-src="attachments/101482571/138456624.jpeg" data-unresolved-comment-count="0" data-linked-resource-id="138456624" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="freshdesk_1.jpeg" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></span></p><p><span style="color: rgb(24,50,71);">Clicking on the Anchore Report link will display a graphical policy reporting showing the summary information and a detailed list of policy checks and results.</span></p><p><span style="color: rgb(24,50,71);"><span style="color: rgb(24,50,71);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="400" src="attachments/101482571/138456625.jpeg" data-image-src="attachments/101482571/138456625.jpeg" data-unresolved-comment-count="0" data-linked-resource-id="138456625" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="freshdesk_2.jpeg" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="101482571" data-linked-resource-container-version="21"></span></span></span></p><h2 id="AnchoreContainerImageScannerPlugin-Pipeline"><span style="color: rgb(24,50,71);"><span style="color: rgb(24,50,71);"><span style="color: rgb(210,73,57);">Pipeline</span><br/></span></span></h2><p><span style="color: rgb(36,41,46);">Following is a sample code snippet for using Anchore Plugin in a pipeline script. For more options refer to Pipeline Syntax and try the Snippet Generator</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: bash; gutter: false; theme: Emacs" data-theme="Emacs">node {
  def imageLine = &#39;debian:latest&#39;
  writeFile file: &#39;anchore_images&#39;, text: imageLine
  anchore name: &#39;anchore_images&#39;
}</pre>
</div></div><p><em><br/></em></p></div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456617.png">image_1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456618.png">image_2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456619.png">image_3.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456620.png">image_4.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456621.png">image_5.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456622.png">image_17.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456623.png">image_9.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456624.jpeg">freshdesk_1.jpeg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456625.jpeg">freshdesk_2.jpeg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/101482571/138456639.png">meh.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Sep 07, 2021 13:11</p>
                    <div id="footer-logo"><a href="/display/">Wiki home</a></div>
                </section>
            </div>
        </div>     </body>
</html>
