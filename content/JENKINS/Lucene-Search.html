<!DOCTYPE html>
<html>
    <head>
        <title>Jenkins : Lucene-Search</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Jenkins</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Plugins.html">Plugins</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Jenkins : Lucene-Search
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (hanabishi)</span>, last modified on Dec 21, 2015
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <table class="confluenceTable"><tbody>
<tr>
<th class="confluenceTh"><p> Plugin Information </p></th>
</tr>
<tr>
<td class="confluenceTd"><p> View Lucene-Search <a href="https://plugins.jenkins.io/lucene-search" class="external-link" rel="nofollow">on the plugin site</a> for more information. </p></td>
</tr>
</tbody></table>

<p>Lucene-Search adds support to search for build data using the Jenkins search box (aka quick navigation). The plugin stores the data after each build in a search database.</p>


<h2 id="Lucene-Search-Installation">Installation</h2>

<p>Install it as a normal plugin and all new builds will be searchable.</p>

<p>Before old builds can be searched, a &quot;Rebuild database&quot; must be performed via the &quot;Manage Jenkins&quot; &gt;&gt;&gt; &quot;Lucene Search Manager&quot;. This step should never have to be done again, but may take a long time if you have many jobs and builds.</p>

<h2 id="Lucene-Search-UpgradetoLucene-Search4.x">Upgrade to Lucene-Search 4.x</h2>

<p>Version 4.0 changed Lucene search engine from version 4 to version 5 so you should recreate the Lucene database after upgrade.</p>

<h2 id="Lucene-Search-Supportedkeywords"><span style="color: rgb(210,73,57);"><strong>Supported keywords</strong></span></h2>

<p><strong>console</strong>: Console output <br/>
<strong>projectdisplayname</strong>: The project display name<br/>
<strong>projectname</strong>: The project name<br/>
<strong>buildnumber</strong>: Project build number*<br/>
<strong>id</strong>: The unique ID generated by Jenkins*<br/>
<strong>duration</strong>: Build duration in ms*<br/>
<strong>starttime</strong>: Start time in ms*<br/>
<strong>builton</strong>: Node name for where the build was run<br/>
<strong>startcause</strong>: Who or what started the build<br/>
<strong>color</strong>: Icon color for the build*'<br/>
<strong>result</strong>: Build result, case sensitive. Example SUCCESS, FAILURE</p>

<p>* Not included in the default search</p>

<p>For more information on how to use search usnig Lucene read </p>

<p><a href="http://lucene.apache.org/core/4_9_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description" class="external-link" rel="nofollow">http://lucene.apache.org/core/4_9_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description</a></p>

<p><span style="color: rgb(210,73,57);"><strong>Solr</strong></span></p>

<p>The easiest way to get Solr up and running is by downloading the lastest stable version (5.3.1 at the time of writing), unpack and do the following:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">
cd solr-5.3.1/example/example-schemaless
java -jar ../start.jar
</pre>
</div></div>
<p>Lucene-Search will set up the fields before it needs them. Adding fields via extension points will require restarting jenkins or reconfiguring the plugin (known bug).</p>

<h3 id="Lucene-Search-Extensionpoint"><span style="color: rgb(210,73,57);"><strong>Extension point</strong></span></h3>

<p>If you are a developer and want to add your own data to the database you can implement the extension point &quot;FreeTextSearchExtension&quot;. This will allow the Lucene plugin to add your data to the database so it can be searched. It is NOT an all or nothing deal, it's easy to support Lucene-Search without requiring it.</p>

<h4 id="Lucene-Search-Mavendependency">Maven dependency</h4>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">
&lt;dependency&gt;
    &lt;groupId&gt;org.jenkins-ci.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;lucene-search&lt;/artifactId&gt;
    &lt;version&gt;X.X&lt;/version&gt;
    &lt;optional&gt;true&lt;/optional&gt; &lt;!-- Only support, not require, lucene-search --&gt;
&lt;/dependency&gt;
</pre>
</div></div>

<p>The </p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;optional&gt;true&lt;/optional&gt;</pre>
</div></div>
<p> is to only add support for Lucene-Search. This is for when you have a plugin that can use Lucene-Search, but doesn't require it for the plugin to work. If Lucene-Search is in the Jenkins instance at runtime, the Lucene-Search plugin will use the extension points defined by the plugin. If not, the ExtensionPoint will not cause any problems.</p>

<h4 id="Lucene-Search-Example">Example</h4>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">
import org.jenkinsci.plugins.lucene.search.FreeTextSearchExtension;


@Extension
public class FitFreeTextSearchExtension extends FreeTextSearchExtension {

    @Override
    public String getKeyword() {
        return &quot;fitsummary&quot;;
    }

    @Override
    public String getTextResult(AbstractBuild&lt;?, ?&gt; build) {
        StringBuilder builder = new StringBuilder();

        for (FitSummaryAction action : build.getActions(FitSummaryAction.class)) {
            builder.append(action.getSummary() + &quot;\n&quot;);
        }

        return builder.toString();

    }

    @Override
    public boolean isPersist() {
        return true;
    }

}
</pre>
</div></div>

<h3 id="Lucene-Search-Comingchanges(completed/prioritized)">Coming changes (completed/prioritized)</h3>

<p>Planned</p>
<ol>
	<li>Improve console hightlightings. &quot;(exit code: 1)&quot; hightlights the word code and the number 1. Would be better if we only hightlight the full match. -Command completed with <strong>code</strong> 0</li>
	<li>Paginating results.</li>
	<li>Find a solution for  the bugs <a href="https://issues.jenkins-ci.org/browse/JENKINS-30325" class="external-link" rel="nofollow">JENKINS-30325</a> and <a href="https://issues.jenkins-ci.org/browse/JENKINS-30665?filter=-2" class="external-link" rel="nofollow">30665</a> where we can not use Lucene without &quot;XX:-UseSplitVerifier&quot; after Jenkins 1.602</li>
</ol>


<h2 id="Lucene-Search-Troubleshooting">Troubleshooting</h2>


<h4 id="Lucene-Search-JDKVersion">JDK Version</h4>


<h6 id="Lucene-Search-TheLucenelibusedbythispluginrequiresthatwerunJenkinswithJava7orlater.HoweverduetoabuginJenkinsbytecodethispluginwillnotworkifyouuseJava8withaJenkinsversionlaterthen1.601.IfyouarerunningonanewerversionyouwillneedtorunwithJava7andaddthejavaarg"><span style="color: rgb(0,0,0);">The Lucene lib used by this plugin requires that we run Jenkins with Java 7 or later. However due to a bug in Jenkins byte code this plugin will not work if you use Java 8 with a Jenkins version later then 1.601. If you are running on a newer version you will need to run with Java 7 and add the java argument </span><span style="color: rgb(0,0,0);">XX:-UseSplitVerifier when starting Jenkins or you will be unable to use the search function.</span></h6>

<p>For more information see Jenkins defect <a href="https://issues.jenkins-ci.org/browse/JENKINS-30665?filter=-2" class="external-link" rel="nofollow">30665</a> </p>

<h6 id="Lucene-Search-Example.1">Example</h6>

<p>JAVA_OPTS=&quot;XX:-UseSplitVerifier&quot;</p>

<p><span style="color: rgb(210,73,57);"><strong>How to search</strong></span></p>

<p>Just a type a string in the search box to search. If you do not include a suffix the search plugin will search in all keywords bellow not marked with a *. If you want to search for a string in a specific field just add the write &lt;KEYWORDS&gt;:&lt;VALUE&gt;.</p>

<h4 id="Lucene-Search-IndexWriterislocked">IndexWriter is locked</h4>

<p>This problem is seen for several reasons<br/>
* The lucene folder on the Jenkins server has invalid user permisions, change the read/write permisions and reconfigure Lucene/restart the Jenkins server<br/>
* Out of permgen memory on Jenkins<br/>
* The solr server has crashed, often as you don't have enough memory on the server.</p>

<h2 id="Lucene-Search-Versions"><span style="color: rgb(210,73,57);"><strong>Versions</strong></span></h2>


<h4 id="Lucene-Search-Version4.2(releaseDec21,2015)">Version 4.2 (release Dec 21, 2015) </h4>

<ul>
	<li>Added missing extension on junit log indexer. It should now be possible to search in junit logs.</li>
</ul>


<h4 id="Lucene-Search-Version4.1(releaseDec19,2015)">Version 4.1 (release Dec 19, 2015) </h4>

<ul>
	<li>Workaround for a bug where searching for &quot;XXX YYY&quot; results in a stacktrace.</li>
</ul>


<h4 id="Lucene-Search-Version4.0(releaseDec18,2015)">Version 4.0 (release Dec 18, 2015) </h4>

<ul>
	<li>Updated Lucene to 5.3.1</li>
	<li>Fixed management GUI bugs</li>
	<li>Added exception handling when calling third party plugin extensions to prevent total log collection failure</li>
</ul>


<h4 id="Lucene-Search-Version3.0(releaseOct15,2015)">Version 3.0 (release Oct 15, 2015)</h4>

<ul>
	<li>Support for workflow</li>
	<li>Added support to search in junit logs</li>
</ul>


<h4 id="Lucene-Search-Version2.1(releaseSep8,2015)">Version 2.1 (release Sep 8, 2015)</h4>

<ul>
	<li>Improved search result presentation</li>
</ul>


<h4 id="Lucene-Search-Version1.15(releasedApr15,2015)">Version 1.15 (released Apr 15, 2015)</h4>

<ul>
	<li>Bug fixes for Solr, primarily tests, but also minor changes to rebuild database backend.</li>
</ul>


<h4 id="Lucene-Search-Version1.14(releasedApr15,2015)">Version 1.14 (released Apr 15, 2015)</h4>

<ul>
	<li>Bug fixes for Solr. It should now be possible to use it without restarting jenkins and rebuild a clean database.</li>
</ul>


<h4 id="Lucene-Search-Version1.13(releasedApr7,2015)">Version 1.13 (released Apr 7, 2015)</h4>

<ul>
	<li>For some reason, 1.12 is not being distributed, but hopefully this release will.</li>
	<li>No changes compared to 1.12 except in a test case. Solr now has working test cases.</li>
</ul>



<h4 id="Lucene-Search-Version1.12(releasedApr1,2015)">Version 1.12 (released Apr 1, 2015)</h4>

<ul>
	<li>Crash bug fixed.</li>
	<li>Minor bug fixes for Lucene.</li>
	<li>When rebuilding, for each build, try to keep old data if no new data can be generated (e.g. if it's based on artifacts).</li>
	<li>Security check returned results. Slows down searches a lot, since all results returned needs to be deserialized and security checked.</li>
	<li>Add stability by adding test cases for Lucene backend.</li>
</ul>


<h4 id="Lucene-Search-Version1.11(releasedMar29,2015)">Version 1.11 (released Mar 29, 2015)</h4>

<ul>
	<li>Display total elapsed time for rebuild database.</li>
	<li>Added plugin to index files. Path globbing works the same as for the artifact archiver.</li>
	<li>All errors when indexing are logged in the log4j output.</li>
</ul>


<h4 id="Lucene-Search-Version1.10(releasedMar26,2015)">Version 1.10 (released Mar 26, 2015)</h4>

<ul>
	<li>Better support for Matrix build names.</li>
	<li>Less brutally ugly icon.</li>
	<li>Create links to full console log and console as text from search result page.</li>
	<li>Search help page with information about all fields indexed, and if persistent, example of what the values may be.</li>
	<li>Many fixes for Solr backend including highlighting, getting rebuilding to work again, avoid search exception.</li>
	<li>Many internal changes, but API is the same.</li>
</ul>


<h4 id="Lucene-Search-Version1.9(releasedMar18,2015)">Version 1.9 (released Mar 18, 2015)</h4>

<ul>
	<li><strong>Bugfix</strong> When rebuilding the database the plugin failed when trying to index new projects.</li>
	<li><strong>Management UI</strong> Improved the Management GUI and added a history table when rebuilding the index.</li>
	<li><strong>Performance</strong> When rebuilding the index the plugin will use several workers in order to improve performance. The number of workers can be set by the user.</li>
</ul>


<h4 id="Lucene-Search-Version1.8(releasedMar10,2015)">Version 1.8 (released Mar 10, 2015)</h4>

<ul>
	<li><strong>SearchModelObject</strong> Now searches will include the results from the default Jenkins search such as direct links to users and jobs.</li>
	<li><strong>Delete old jobs</strong> Delete all jobs somehow failed on Lucene backend (or never worked?). Fixed now.</li>
	<li><strong>Rebuild database</strong> Rebuilding database now works as it should for Lucene backend. Test cases for this sorely needed.</li>
	<li><strong>Default Locale avoided</strong> Avoid using default locale for Lucene for portability.</li>
</ul>


<h4 id="Lucene-Search-Version1.6(releasedMar5,2015)">Version 1.6 (released Mar 5, 2015)</h4>

<ul>
	<li><strong>Lucene Management page:</strong> Page to rebuild the database after for example upgrading plugins with Lucene extensions.</li>
	<li><strong>Extension points:</strong> Fix for new extension point fields needing restart of Jenkins (only for Solr)</li>
	<li><strong>Maintenance feature:</strong>  clean up builds that are in search database but not in Jenkins anymore</li>
	<li><strong>Data Migration:</strong> Migrate data when changing Solr &lt;-&gt; Lucene, especially Lucene -&gt; Solr</li>
	<li><strong>Usability:</strong> Prefill a dropdown with collections for Solr instead of a text field</li>
</ul>


<h4 id="Lucene-Search-Version1.2(releasedSep3,2014)">Version 1.2 (released Sep 3, 2014)</h4>

<ul>
	<li><strong>New data format</strong> (will probably cause problems until purged with Old Data)</li>
	<li><strong>Solr support,</strong> i.e. external search server support. Solr needs to be set up in a managed schemaless configuration. Documentation above</li>
	<li>Removed Nisse feature (debug string that was printed on search)</li>
	<li><strong>Updated FreeTextSearchExtension</strong>, renamed persist() to isPersist()</li>
</ul>


<h4 id="Lucene-Search-Version1.1(releasedAug31,2014)">Version 1.1 (released Aug 31, 2014)</h4>

<ul>
	<li>Fixed No means Yes bug, also knows as the rape bug.</li>
</ul>



<h4 id="Lucene-Search-Version1.0(releasedAug31,2014)">Version 1.0 (released Aug 31, 2014)</h4>

<ul>
	<li>Lucene plugin was released to the world.</li>
</ul>
                    </div>

                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Sep 07, 2021 13:32</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
