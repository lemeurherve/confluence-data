<!DOCTYPE html>
<html>
    <head>
        <title>Jenkins : Scoring Load Balancer plugin</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Jenkins</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home.html">Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Plugins.html">Plugins</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Jenkins : Scoring Load Balancer plugin
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (ikedam)</span>, last modified on Oct 15, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><table class="confluenceTable"><tbody>
<tr>
<th class="confluenceTh"><p> Plugin Information </p></th>
</tr>
<tr>
<td class="confluenceTd"><p> View Scoring Load Balancer <a href="https://plugins.jenkins.io/scoring-load-balancer" class="external-link" rel="nofollow">on the plugin site</a> for more information. </p></td>
</tr>
</tbody></table>
Decides a build run on which node by scoring nodes.</p><h2 id="ScoringLoadBalancerplugin-What&#39;sthis?">What's this?</h2><p>This plugin provides following features:</p><ul><li>Decides a node where a build run depending on scores of nodes.</li><li>Provides following scoring rules. New ones can be added using `ExtensionPoint`.<ul><li>Scoring by Build Results<ul><li>Prefers nodes where the last builds of the project succeeded.</li><li>Avoids nodes where the last builds of the project failed.</li></ul></li><li>Scoring by Node Loads<ul><li>Prefers nodes where more executers remain.</li><li>Avoids nodes where more builds run.</li></ul></li><li>Scoring by Node Preferences<ul><li>Prefers nodes marked &quot;Preferred&quot; in configuration of the building project.</li><li>Prefers nodes with labels marked &quot;Preferred&quot; in configuration of the building project.</li><li>Prefers nodes marked &quot;Preferred&quot; in configuration of nodes.</li></ul></li></ul></li><li>Scoring rules are configured in &quot;Manage Jenkins&quot; &gt; &quot;Configure System&quot;<ul><li>Pick up available scoring rules and put them in preferred order.<ul><li>Each scoring rules provides its configuration.</li><li>You can put scoring rules twice or more, but it might be useless for current providing methods.</li></ul></li></ul></li></ul><h2 id="ScoringLoadBalancerplugin-Screenshots">Screenshots</h2><ul><li>Scoring Load Balancer plugin adds a new configuration section to &quot;Manage Jenkins&quot; &gt; &quot;Configure System&quot; page. You can add rules to decide which nodes is preferred to use for building.<br/> <span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-content-image-border image-center" src="attachments/69273859/71008284.png" data-image-src="attachments/69273859/71008284.png" data-unresolved-comment-count="0" data-linked-resource-id="71008284" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="scoring-load-balancer_01_systemconfig.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="69273859" data-linked-resource-container-version="12"></span></li><li>&quot;Scoring by Build Results&quot; scores a node by past results of builds on that node. You can configure weights of successes and failures.<br/> <span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-content-image-border image-center" src="attachments/69273859/71008285.png" data-image-src="attachments/69273859/71008285.png" data-unresolved-comment-count="0" data-linked-resource-id="71008285" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="scoring-load-balancer_02_buildresults.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="69273859" data-linked-resource-container-version="12"></span></li><li>&quot;Scoring by Node Loads&quot; scores a node by the number of builds are running on that node now.<br/> <span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-content-image-border image-center" src="attachments/69273859/71008286.png" data-image-src="attachments/69273859/71008286.png" data-unresolved-comment-count="0" data-linked-resource-id="71008286" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="scoring-load-balancer_03_nodeloads.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="69273859" data-linked-resource-container-version="12"></span></li><li>&quot;Scoring by Node Preference&quot; scores a node by preference configuration in nodes or projects.<br/> <span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-content-image-border image-center" src="attachments/69273859/71008283.png" data-image-src="attachments/69273859/71008283.png" data-unresolved-comment-count="0" data-linked-resource-id="71008283" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="scoring-load-balancer_04_preference.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="69273859" data-linked-resource-container-version="12"></span><ul><li>In node configuration pages, &quot;Preference of Node&quot; can be specified.<br/> <span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-content-image-border image-center" src="attachments/69273859/71008282.png" data-image-src="attachments/69273859/71008282.png" data-unresolved-comment-count="0" data-linked-resource-id="71008282" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="scoring-load-balancer_05_nodepreference.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="69273859" data-linked-resource-container-version="12"></span></li><li>In project configuration pages, &quot;Preference of Node&quot; appears. You can specify scores for nodes or node labels. Multiple preferences can be specified.<br/> <span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-content-image-border image-center" src="attachments/69273859/71008287.png" data-image-src="attachments/69273859/71008287.png" data-unresolved-comment-count="0" data-linked-resource-id="71008287" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="scoring-load-balancer_06_projectpreference.png" data-base-url="https://wiki.jenkins.io" data-linked-resource-content-type="image/png" data-linked-resource-container-id="69273859" data-linked-resource-container-version="12"></span></li></ul></li></ul><h2 id="ScoringLoadBalancerplugin-Howdoesthiswork?">How does this work?</h2><p>You may read later &quot;WorkChunks and ExecutorChunks&quot; first for understanding how Jenkins works for build assignment.</p><p>This plugin works as following:</p><ol><li>When the plugin loaded, replaces the default <code>LoadBalancer</code> to <code>ScoringLoadBalancer</code>.</li><li>Jenkins requests to map builds to nodes ( <code>LoadBalancer#map</code>)</li><li>Pick the first WorkChunk (that is, subtask).</li><li>Score all nodes by calling all configured <code>ScoringRule</code><ul><li>You can define a new scoring rule by creating a subclass of <code>ScoringRule</code>.</li></ul></li><li>Pick the ExecutorChunk with the highest score node. Assign that ExecutorChunk to the current WorkChunk.</li><li>Pick the next WorkChunk, and back to 4. Scoring is performed for each WorkChunk, for the case scores differ for each subtask.</li><li>If assignment is failed (e.g. some constrains is broken), pick the next ExecutorChunk, and back to 6.</li><li>If assignment is succeeded, it is used.</li></ol><h2 id="ScoringLoadBalancerplugin-WorkChunksandExecutorChunks">WorkChunks and ExecutorChunks</h2><p>In simple cases, Jenkins launches only one build at the same time.<br/> Though multi-configuration project results in multiple builds even triggered once,<br/> these builds are launched just one by one sequentially.</p><p>But there are cases Jenkins launches two or more builds at the same time.<br/> SEE <code>JobProperty#getSubTasks</code> or <code>SubTaskContributor</code> for details.</p><p>Before builds start on node, Jenkins requests to map tasks to executors.<br/> Here are definitions of words:</p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><th class="confluenceTh"><p>Word</p></th><th class="confluenceTh"><p>Explanation</p></th></tr><tr><td class="confluenceTd"><p>Task</p></td><td class="confluenceTd"><p>A root source of builds. Includes <code>FreeStyleProject</code>, <code>MatrixConfiguration</code>. <code>MatrixProject</code> is also a task, but not processed with LoadBalancer (for it is a <code>FlyWeightTask</code> ).</p></td></tr><tr><td class="confluenceTd"><p>SubTask</p></td><td class="confluenceTd"><p>A task may contain multiple subtasks. One subtask creates one build. Generally, a task contains itself as a subtask. For example, task <code>FreeStyleProject</code> contains a subtask <code>FreeStyleProject</code> itself and other subtasks created by <code>JobProperty#getSubTasks</code> or <code>SubTaskContributor</code>.</p></td></tr><tr><td class="confluenceTd"><p>Build</p></td><td class="confluenceTd"><p>A process runs on a computer. A build is created by a subtask.</p></td></tr><tr><td class="confluenceTd"><p>Node</p></td><td class="confluenceTd"><p>One can be registered in &quot;Manage Nodes&quot;.</p></td></tr><tr><td class="confluenceTd"><p>Computer</p></td><td class="confluenceTd"><p>A node which is connected and builds can run on now.</p></td></tr><tr><td class="confluenceTd"><p>Executor</p></td><td class="confluenceTd"><p>Build slots a computer provides. The number of executer of a node can be configured with &quot;# of executors&quot; in &quot;Manage Nodes&quot; page.</p></td></tr></tbody></table></div><p>When Jenkins requests to map tasks to executors,<br/> it passes <code>WorkChunk</code> s and <code>ExecutorChunk</code> s.</p><p><code>WorkChunk</code> groups subtasks that must run on a same node. Subtasks can be grouped by <code>SubTask#getSameNodeConstraint</code> returning the same <code>Object</code>.</p><p><code>ExecutorChunk</code> groups executors by their computers (that is by nodes).</p><h2 id="ScoringLoadBalancerplugin-Extensionpoint">Extension point</h2><p>New scoring rule can be added with extending <code>ScoringRule</code>, overriding the following method:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public abstract boolean updateScores(Task task, WorkChunk wc, Mapping m, NodesScore nodesScore);
</pre>
</div></div><p>You can score nodes by updating <code>nodesScore</code>.</p><h2 id="ScoringLoadBalancerplugin-Limitations">Limitations</h2><ul><li>A performance problem may occurs for a large number of nodes.<ul><li>I've tested the behavior with only 10 nodes.</li></ul></li></ul><h2 id="ScoringLoadBalancerplugin-Issues">Issues</h2><p>To report a bug or request an enhancement to this plugin please create a ticket in JIRA (you need to login or to sign up for an account). Also have a look on <a href="How-to-report-an-issue.html">How to report an issue</a></p><ul><li><a href="https://issues.jenkins-ci.org/secure/CreateIssueDetails!init.jspa?pid=10172&amp;issuetype=1&amp;components=18051&amp;priority=4&amp;assignee=ikedam" class="external-link" rel="nofollow">Bug report</a></li><li><a href="https://issues.jenkins-ci.org/secure/CreateIssueDetails!init.jspa?pid=10172&amp;issuetype=4&amp;components=18051&amp;priority=4" class="external-link" rel="nofollow">Request or propose an improvement of existing feature</a></li><li><a href="https://issues.jenkins-ci.org/secure/CreateIssueDetails!init.jspa?pid=10172&amp;issuetype=2&amp;components=18051&amp;priority=4" class="external-link" rel="nofollow">Request or propose a new feature</a></li></ul><p>





<div id="refresh-module--1645874649" class="refresh-module-id jira-table" >
<p>
    
        
    
        
    <div id="jira-issues--1645874649" style="width: 100%;  overflow: auto;"
         class="jira-issues">
        <table class="aui" >
            <tbody>
            <tr></tr>             <tr>
                                                            
                                                    <th style="text-align: left; text-transform: capitalize;"
                                class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span
                                    class="jim-table-header-content">Key</span></th>
                                                                                                        
                                                    <th style="text-align: left; text-transform: capitalize;"
                                class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span
                                    class="jim-table-header-content">T</span></th>
                                                                                                        
                                                    <th style="text-align: left; text-transform: capitalize;"
                                class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span
                                    class="jim-table-header-content">P</span></th>
                                                                                                        
                                                    <th style="text-align: left; text-transform: capitalize;"
                                class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span
                                    class="jim-table-header-content">Summary</span></th>
                                                                        </tr>
                                                                                                                    <tr class="rowNormal">
                                                                                                                        <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-65699?src=confmacro">JENKINS-65699</a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-65699?src=confmacro"><img
                                                src="https://issues.jenkins.io/secure/viewavatar?size=xsmall&amp;avatarId=14680&amp;avatarType=issuetype"
                                                alt="Improvement"
                                                class="icon"/></a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <img src="https://issues.jenkins.io/images/icons/priorities/minor.svg"
                                             alt="Minor"
                                             class="icon"/>
                                                                    </td>
                                                            <td                                     class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-65699?src=confmacro">
                                            missing interoperability with swam plugin
                                        </a>
                                                                    </td>
                                                    </tr>
                                                                                                                                                        <tr class="rowAlternate">
                                                                                                                        <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-62356?src=confmacro">JENKINS-62356</a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-62356?src=confmacro"><img
                                                src="https://issues.jenkins.io/secure/viewavatar?size=xsmall&amp;avatarId=14681&amp;avatarType=issuetype"
                                                alt="New Feature"
                                                class="icon"/></a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <img src="https://issues.jenkins.io/images/icons/priorities/minor.svg"
                                             alt="Minor"
                                             class="icon"/>
                                                                    </td>
                                                            <td                                     class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-62356?src=confmacro">
                                            Launch on-demand agents with higher score
                                        </a>
                                                                    </td>
                                                    </tr>
                                                                                                                                                        <tr class="rowNormal">
                                                                                                                        <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-41267?src=confmacro">JENKINS-41267</a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-41267?src=confmacro"><img
                                                src="https://issues.jenkins.io/secure/viewavatar?size=xsmall&amp;avatarId=14680&amp;avatarType=issuetype"
                                                alt="Improvement"
                                                class="icon"/></a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <img src="https://issues.jenkins.io/images/icons/priorities/minor.svg"
                                             alt="Minor"
                                             class="icon"/>
                                                                    </td>
                                                            <td                                     class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-41267?src=confmacro">
                                            scoring-load-balancer support for pipeline jobs
                                        </a>
                                                                    </td>
                                                    </tr>
                                                                                                                                                        <tr class="rowAlternate">
                                                                                                                        <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-20439?src=confmacro">JENKINS-20439</a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-20439?src=confmacro"><img
                                                src="https://issues.jenkins.io/secure/viewavatar?size=xsmall&amp;avatarId=14680&amp;avatarType=issuetype"
                                                alt="Improvement"
                                                class="icon"/></a>
                                                                    </td>
                                                            <td nowrap="true"                                    class="jira-macro-table-underline-pdfexport" >
                                                                            <img src="https://issues.jenkins.io/images/icons/priorities/major.svg"
                                             alt="Major"
                                             class="icon"/>
                                                                    </td>
                                                            <td                                     class="jira-macro-table-underline-pdfexport" >
                                                                            <a href="https://issues.jenkins.io/browse/JENKINS-20439?src=confmacro">
                                            Scoring-load-balancer - Scoring Rule for nodes which have workspace checked out
                                        </a>
                                                                    </td>
                                                    </tr>
                                                                                                                        <tr>
                    <td colspan="4">
                        <div class="jira-oauth-message-marker">
                            <div class="aui-message-container">
                                <div class="aui-message info">
                                    <span><a class="static-oauth-init" href="https://wiki.jenkins.io/plugins/servlet/applinks/oauth/login-dance/authorize?applicationLinkID=dd058dce-0c66-3b77-8b09-71b1d7728747">Authenticate</a> to retrieve your issues</span>
                                    <span class="aui-icon icon-info"></span>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                            </tbody>
        </table>
    </div>
            <div class="refresh-issues-bottom">
                            <span id="total-issues-count" class="total-issues-count">
                                                                    <a rel="nofollow" title="View all matching issues in Jira."
                           href="https://issues.jenkins.io/secure/IssueNavigator.jspa?reset=true&amp;jqlQuery=project+%3D+JENKINS+AND+status+in+%28Open%2C+%22In+Progress%22%2C+Reopened%2C+%22In+Review%22%2C+Verified%29+AND+component+%3D+%27scoring-load-balancer-plugin%27+++&amp;src=confmacro">
                                                            4 issues
                                                    </a>
                                        </span>
                                </div>
        </p>

    
</div>
</p><h2 id="ScoringLoadBalancerplugin-ChangeLog">Change Log</h2><h3 id="ScoringLoadBalancerplugin-Version1.0.1(Nov07,2013)">Version 1.0.1 (Nov 07, 2013)</h3><ul><li>Fixed NPE happining when BuildPreferenceJobProperty is enabled but not configured.</li></ul><h3 id="ScoringLoadBalancerplugin-Version1.0.0(Sep07,2013)">Version 1.0.0 (Sep 07, 2013)</h3><ul><li>Initial release.</li></ul>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/69273859/71008282.png">scoring-load-balancer_05_nodepreference.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/69273859/71008283.png">scoring-load-balancer_04_preference.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/69273859/71008284.png">scoring-load-balancer_01_systemconfig.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/69273859/71008285.png">scoring-load-balancer_02_buildresults.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/69273859/71008286.png">scoring-load-balancer_03_nodeloads.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/69273859/71008287.png">scoring-load-balancer_06_projectpreference.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Sep 07, 2021 13:45</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
